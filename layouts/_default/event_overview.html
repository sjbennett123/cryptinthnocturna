{{ partial "header.html" . }}

<p>{{ .Params.description }}</p>

{{ if .Params.event_date }}
{{ if .Content }} 
<hr>
{{ .Content }}
<hr>
{{ end }} 

<script>
    CountDownTimer('{{ .Params.event_date }}', 'countdown');

    function CountDownTimer(dt, id)
    {
        var end = new Date(dt);

        var _second = 1000;
        var _minute = _second * 60;
        var _hour = _minute * 60;
        var _day = _hour * 24;
        var timer;

        function showRemaining() {
            var now = new Date();
            var distance = end - now;
            if (distance < 0) {

                clearInterval(timer);
                document.getElementById(id).innerHTML = 'EXPIRED!';

                return;
            }
            var days = Math.floor(distance / _day);
            var hours = Math.floor((distance % _day) / _hour);
            var minutes = Math.floor((distance % _hour) / _minute);
            var seconds = Math.floor((distance % _minute) / _second);

            document.getElementById(id).innerHTML = days + 'days ';
            document.getElementById(id).innerHTML += hours + 'hrs ';
            document.getElementById(id).innerHTML += minutes + 'mins ';
            document.getElementById(id).innerHTML += seconds + 'secs';
        }

        timer = setInterval(showRemaining, 1000);
    }

</script>
<h2>Time Until Event</h2><p><div id="countdown"></div></p>
{{ end }} 


<h2>Plotline Overview</h2>
{{ range (where .Pages "Layout" "plotline_overview") }}
      <p><a href="{{.Permalink}}"><b>{{ .Title }}</b></a> {{ .Params.description }} </p>
{{ end }}

<p><h2>Modules To Run</h2> 
The modules below are in the order that we intend to run them in.

<h3>Friday</h3>
{{ range sort (where (where .Pages "Layout" "IN" (slice "module" "module_review") ) "Params.day" "=="  "friday") "Params.weight"}}
      <p><a href="{{.Permalink}}"><b>{{ .Title }}</b></a> {{ .Params.description }} </p>
{{ end }}

<h3>Saturday</h3>
{{ range where (where .Pages "Layout" "IN" (slice "module" ) ) "Params.day" "=="  "saturday" }}
      <p><a href="{{.Permalink}}"><b>{{ .Title }}</b></a> {{ .Params.description }} </p>
{{ end }}

<h3>Reaction</h3>
{{ range where (where .Pages "Layout" "IN" (slice "module" ) ) "Params.day" "=="  "reaction" }}
      <p><b>{{ .Params.requirements }}</b> -- <a href="{{.Permalink}}"><b>{{ .Title }}</b></a> {{ .Params.description }} </p>
{{ end }}

<h3>Modules for Review</h3>
<!--Make this not display if you don't have any to reveiew-->

{{ range where (where .Pages "Layout" "IN" (slice "module" )) "Params.reviewer" "=" nil }}
      <p><a href="{{.Permalink}}"><b>{{ .Title }}</b></a>  Written by {{ .Params.author }} </p>
{{ end  }}
<h3>Randoms</h3>

<h3>Townsfolk</h3>

<h3>Unsorted</h3>

<h2>Treasure</h2>
<!--get magic items from modules. Add a link to the module in the magic item.-->

{{ $magic_items := (slice )  }}
{{ if .Params.magic_items }}
    {{ $magic_items = append $magic_items .Params.magic_items }}
{{ end }}

{{ range  $magic_items  }}
<h4> {{ .name }} </h4>
<p><b>Description:</b> {{ .description }} </p>
<p><b>Duration:</b> {{ .duration }}    </p>
{{ if .module }} <p><b>Module:</b> {{ .module }}   </p> {{ end }}
<p><b>Effects:</b> {{ delimit .effects ", " }}  </p>
{{ end }} 




{{ $makeup := (slice ) }}
{{ if  .Params.makeup }} 
    {{ $makeup = $makeup  | append .Params.makeup }} 
{{ end }}

{{ if .Pages }} 
    {{ range  .Pages  }}
           {{ if  .Params.makeup }}{{ $makeup = $makeup  | append .Params.makeup }}{{ end }}
    {{ end }}
{{ end }}

{{ range .Pages }}


                        {{ range (.Pages.GroupBy "Section") }}
                           {{ range .Pages }}
                                {{ if  .Params.makeup }}{{ $makeup = $makeup  | append .Params.makeup }}{{ end }}

                           {{ end }}
                        {{ end }}      
      
{{ end }}

{{ $makeup = $makeup | uniq }} 
{{ $makeup = $makeup | sort }} 
{{ if (gt ($makeup | len) 0) }}
<div id="makeup"> <h2>Makeup </h2>
{{ range $makeup }}
<li>{{ . }} </li>
{{ end }} 
</p></div> 
{{ end }}



{{ $props := (slice ) }}
{{ if  .Params.props }} 
    {{ $props = $props  | append .Params.props }} 
{{ end }}

{{ if .Pages }} 
    {{ range  .Pages  }}
           {{ if  .Params.props }}{{ $props = $props  | append .Params.props }}{{ end }}
    {{ end }}
{{ end }}

{{ range .Pages }}


                        {{ range (.Pages.GroupBy "Section") }}
                           {{ range .Pages }}
                                {{ if  .Params.props }}{{ $props = $props  | append .Params.props }}{{ end }}

                           {{ end }}
                        {{ end }}      
      
{{ end }}

{{ $props = $props | uniq }} 
{{ $props = $props | sort }} 


{{ if (gt ($props | len) 0) }}
<div id="props"> <h2>Props </h2>
{{ range $props }}
<li>{{ title . }} </li>
{{ end }} 
</p></div> 
{{ end }}




{{ partial "footer.html" . }}
