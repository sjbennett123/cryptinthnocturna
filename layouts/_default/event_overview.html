{{- partial "header.html" . -}}

<p>{{- .Params.description -}}</p>
<h2>Top Secret</h2>
<img src="/top_secret.png" alt="/top_secret.png" title="{width='10%'}">
<div style="text-align:center"><p>If you are PCing this event TURN BACK NOW!</p></div>
{{- if .Content -}} 
<hr>
{{- .Content -}}
<hr>
{{- end -}} 

{{- if .Params.event_date -}}
<h2>Time Until Event</h2>
  <div class="wrapper">
    <div class="countdown" data-date="{{- .Params.event_date -}}" data-time="09:00">
      <div class="day"><span class="num"></span><span class="word"></span></div>
      <div class="hour"><span class="num"></span><span class="word"></span></div>
      <div class="min"><span class="num"></span><span class="word"></span></div>
      <div class="sec"><span class="num"></span><span class="word"></span></div>
    </div>
  </div>
  <script type="text/javascript" src="/countdown.js"></script>
  <script type="text/javascript" src="/countdown_init.js"></script>
{{- end -}} 

{{ if (where .Pages "Layout" "plotline_overview") }}
<h2>Plotline Overview</h2>
{{ range (where .Pages "Layout" "plotline_overview") }}
      <p><a href="{{.Permalink}}"><b>{{ .Title }}</b></a> {{ .Params.description }} </p>
{{- end -}}
{{- end -}}

<p><h2>Modules To Run</h2></p>
<p><b>{{- len (where .Pages "Layout" "==" "module") -}}</b> Modules to run </p>
<p>The modules below are in the order that we intend to run them in. We do not use a timeline we instead attempt to run these in this order the best we can. Plans will change and we will adapt. </p>

{{ if sort (where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "=="  "friday") "Params.weight" -}}
<h3>Friday</h3>
<p><b>{{ len (where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "=="  "friday" ) -}}</b> Modules to run </p>

{{ range sort (where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "=="  "friday") "Params.weight" -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a> {{ .Params.description -}} </p>
{{ end }}
{{ end }}
{{ if where (where .Pages "Layout" "==" "module"  ) ".Params.schedule"  "=="  "saturday" -}}
<h3>Saturday</h3>
<p><b>{{- len (where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "=="  "saturday" ) -}}</b> Modules to run </p>

{{ range where (where .Pages "Layout" "IN" (slice "module" ) ) ".Params.schedule" "=="  "saturday" -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a> {{ .Params.description -}} </p>
{{ end }}
{{ end }}

{{ if where (where .Pages "Layout" "==" "module" ) ".Params.schedule"  "=="  "reaction" -}}
<h3>Reaction</h3>
{{ range where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "=="  "reaction" -}}
      <p><b>{{ .Params.requirements }}</b> -- <a href="{{.Permalink}}"><b>{{ title .Title }}</b></a> {{ .Params.description }} </p>
{{ end }}
{{ end }}



{{ if where (where .Pages "Layout" "IN" (slice "module" ) ) "Params.schedule"  "=="  "townsfolk" -}}
<h3>Townsfolk</h3>
{{ range where (where .Pages "Layout" "IN" (slice "module" ) ) "Params.schedule"  "=="  "townsfolk" -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a> {{- .Params.description -}} </p>
{{ end }}
{{ end }}


{{ if where (where .Pages "Layout" "==" "module"  ) "Params.schedule"  "=="  "randoms" -}}
<h3>Randoms</h3>
{{ range where (where .Pages "Layout" "==" "module"  ) "Params.schedule"  "=="  "randoms" -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a> {{ .Params.description -}} </p>
{{ end }}
{{ end }}


<h3>Unsorted</h3>
{{ range where (where (where .Pages "Layout" "==" "module" ) ".Params.schedule" "==" nil)  ".Params.title" "!=" nil -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a>  Written by {{ title .Params.author -}} </p>
{{ end }} 



{{ if  where (where (where .Pages "Layout" "IN" (slice "module" )) "Params.reviewer" "=" nil) "Params.synopsis" "!=" nil -}}

<h3>Modules for Review</h3>
<p>https://gloryforthefist.netlify.app/writing/#reviewing-tips</p>
{{ range sort (where (where (where .Pages "Layout" "IN" (slice "module" )) "Params.reviewer" "=" nil) "Params.synopsis" "!=" nil) .Params.author  -}}
      <p><a href="{{.Permalink}}"><b>{{ title .Title }}</b></a>  Written by {{ title .Params.author -}} </p>
{{- end -}}
{{- end -}} 
<h2>Treasure</h2>

{{- $magic_items := (slice ) -}}

{{- if .Params.magic_items -}}
    {{- $magic_items = append $magic_items .Params.magic_items -}}
{{- end -}}

 {{- range  where .Pages ".Params.magic_items" "!=" nil -}}
  {{- $permalink := .Permalink -}} 
    {{- $module_name := .Title -}} 

           {{- range .Params.magic_items -}} 
                {{- $magic_item_to_add := dict "name" .name "description" .description "duration" .duration "effects" .effects "link" $permalink "module" $module_name "delimit" .delimit -}}
                {{- $magic_items = append $magic_items (slice $magic_item_to_add) -}}
           {{- end -}}
    {{- end -}}
    
{{- if where $magic_items ".duration" "==" "2 Year" -}}
<h4>Two Year Magic Items</h4>
{{- end -}}
{{- range  $magic_items  -}}
{{- if ( eq .duration "2 Year" )   }} 
<h5>{{ title .name }}</h5>
<p><b>Description:</b> {{ .description }} </p>
<p><b>Duration:</b> {{ .duration }}    </p>
{{ if .module -}} <p><b>Module:</b> <a href="{{- .link -}}/#treasure">{{ title .module }}</a></p> {{- end -}}
{{ if .delimit }} <p><b>Delimit:</b> {{ .delimit }}   </p> {{ end }}
<p><b>Effects:</b> {{ delimit .effects ", " }} </p>
{{ end }} 
{{ end }}
{{- if where (where $magic_items ".duration" "==" "1 Year")  ".delimit" "ne" "Delimited to 15th Level or Below" -}}
<h4>One Year Magic Items</h4>
{{- end -}}

{{- range  $magic_items  }}
{{- if and ( eq .duration "1 Year" ) ( ne .delimit "Delimited to 15th Level or Below") -}} 
<h5>{{ title .name }}</h5>
<p><b>Description:</b> {{ .description }} </p>
<p><b>Duration:</b> {{ .duration }}    </p>
{{- if .module -}} <p><b>Module:</b> <a href="{{- .link -}}/#treasure">{{ title .module }}</a></p> {{- end -}}
{{- if .delimit }} <p><b>Delimit:</b> {{ .delimit }}   </p> {{ end }}
<p><b>Effects:</b> {{ delimit .effects ", " }} </p>
{{- end }} 
{{- end }}
{{- if where (where $magic_items ".duration" "==" "1 Year")  ".delimit" "==" "Delimited to 15th Level or Below" -}}
<h4>One Year Magic Items Delimited to under 15'th Level</h4>
{{- end }}

{{- range  $magic_items  -}}
{{- if and ( eq .duration "1 Year" ) ( eq .delimit "Delimited to 15th Level or Below") -}} 
<h5>{{- title .name -}}</h5>
<p><b>Description:</b> {{- .description -}} </p>
<p><b>Duration:</b> {{- .duration -}}    </p>
{{- if .module -}} <p><b>Module:</b> <a href="{{- .link -}}/#treasure">{{- title .module -}}</a></p> {{- end -}}
{{- if .delimit -}} <p><b>Delimit:</b> {{- .delimit -}}   </p> {{- end -}}
<p><b>Effects:</b> {{- delimit .effects ", " -}} </p>
{{ end }} 




{{ end }}



{{- $rumors := (slice ) -}}
{{- if  .Params.rumors -}} 
    {{- $rumors = $rumors  | append .Params.rumors -}} 
{{- end -}}
{{- if .Pages -}} 
    {{ range  .Pages -}}
           {{- if  .Params.rumors -}}{{- $rumors = $rumors  | append .Params.rumors -}}{{- end -}}
    {{- end -}}
{{- end -}}

{{- $rumors = $rumors | uniq -}} 
{{- $rumors = $rumors | shuffle -}} 
{{- if (gt ($rumors | len) 0) -}}
<div id="rumors"> <h2>Rumors </h2>
<p><b>{{- len $rumors -}}</b> Rumors to distribute to Discord and Facebook In Game Forum</p><hr>
{{- range $rumors -}}
<p>{{- . | markdownify -}}</p>
<div style="text-align:center"><p>~               ~</p></div>
{{- end -}} 
</p></div> 
{{- end -}} 


{{- $props := (slice ) -}}
{{- if  .Params.props -}} 
    {{- $props = $props  | append .Params.props -}}
{{- end -}}

{{- if .Pages -}}
    {{- range  .Pages -}}
           {{- if  .Params.props }}{{ $props = $props  | append .Params.props -}}{{- end -}}
    {{- end -}}
{{- end -}}

{{- range .Pages -}}


                        {{- range (.Pages.GroupBy "Section") }}
                           {{- range .Pages -}}
                                {{- $props_to_add := (slice ) }}
                                {{- range .Params.props }}
                                    {{- $latest_prop := . | title }} 
                                    {{- $props_to_add := $props_to_add |append  $latest_prop }} 
                                {{- $props = $props  | append $props_to_add }}{{ end }}

                           {{ end }}
                        {{ end }}      
      
{{ end }}

{{ $props = $props | uniq }} 
{{ $props = $props | sort }} 

{{ if (gt ($props | len) 0) }}
<div id="props"> <h2>Props </h2>
{{ range $props }}
<li>{{ title . }} </li>
{{ end }} 
</p></div> 
{{ end }}


{{ $makeup := (slice ) }}
{{ if  .Params.makeup }} 
    {{ $makeup = $makeup  | append .Params.makeup }} 
{{ end }}

{{ if .Pages }} 
    {{ range  .Pages  }}
           {{ if  .Params.makeup }}{{ $makeup = $makeup  | append .Params.makeup }}{{ end }}
    {{ end }}
{{ end }}

{{- range .Pages -}}


                        {{- range (.Pages.GroupBy "Section") -}}
                           {{- range .Pages -}}
                                {{- $makeup_to_add := (slice ) -}}
                                {{- range .Params.makeup -}}
                                    {{- $latest_prop := . | title -}} 
                                    {{- $makeup_to_add := $makeup_to_add |append  $latest_prop -}} 
                                {{- $makeup = $makeup  | append $makeup_to_add }}{{ end }}

                           {{- end -}}
                        {{- end -}}
      
{{- end -}}

{{- $makeup = $makeup | uniq -}} 
{{- $makeup = $makeup | sort -}} 

{{- if (gt ($makeup | len) 0) -}}
<div id="makeup"> <h2>Makeup </h2>
{{- range $makeup -}}
<li>{{- title . -}}</li>
{{- end -}} 
</p></div> 
{{- end -}}


{{- $costuming := (slice ) -}}
{{- if  .Params.costuming -}} 
    {{- $costuming = $costuming  | append .Params.costuming -}} 
{{- end -}}

{{- if .Pages -}} 
    {{- range  .Pages -}}
           {{- if  .Params.costuming }}{{ $costuming = $costuming  | append .Params.costuming -}}{{- end -}}
    {{- end -}}
{{- end -}}

{{- range .Pages -}}


                        {{- range (.Pages.GroupBy "Section") -}}
                           {{- range .Pages -}}
                                {{- $costuming_to_add := (slice ) -}}
                                {{- $working_costume := (slice ) -}}
                                {{- if not (reflect.IsSlice .Params.costuming) }}{{ $working_costume = (slice .Params.costuming ) -}}
                                {{- else  -}} {{- $working_costume = append $costuming .Params.costuming }}{{ end -}}
                                {{- range $working_costume -}}
                                    {{- $latest_costume := . | title -}} 
                                    {{- $costuming_to_add := $costuming_to_add |append  $latest_costume -}} 
                                {{- $costuming = $costuming  | append $costuming_to_add -}}{{- end -}}

                           {{- end -}}
                        {{- end -}}      
      
{{- end -}}

{{- $costuming = $costuming | uniq -}} 
{{- $costuming = $costuming | sort -}} 

{{- if (gt ($costuming | len) 0) -}}
<div id="costuming"> <h2>Costuming </h2>
{{- range $costuming }}
{{- if . -}}<li>{{- title . -}}</li>{{- end -}}
{{- end -}} 
</p></div> 
{{- end -}}


{{- partial "footer.html" . -}}