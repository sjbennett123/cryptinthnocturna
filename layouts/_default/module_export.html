{{ $event_pages := where $.Site.Pages "Section" .Section }}
{{ $schedules := (slice "friday" "friday night" "saturday" "saturday morning" "saturday early afternoon" "saturday early evening" "saturday night" "reaction" "tavern_setup" "townsfolk" "randoms" nil) }}


{{ range  $schedules }}
{{ $current_schedule := . }} 


{{ if sort (where (where $event_pages "Layout" "==" "module" ) ".Params.schedule" "=="  $current_schedule ) "Params.weight" -}}
<h3>{{ title  $current_schedule }}{{ if eq $current_schedule  nil }} NO SCHEDULE!! {{ end }}</h3>
<p><b>{{ len (where (where $event_pages "Layout" "==" "module" ) ".Params.schedule" "=="  $current_schedule ) -}}</b> Modules to run </p>
{{ if eq $current_schedule  nil }}<p>Please add a schedule to your modules</p>{{ end }}
{{ range sort (where (where $event_pages "Layout" "=="  "module" ) ".Params.schedule" "=="  $current_schedule) "Params.weight" -}}
      <p>{{- if .Params.reviewer  -}}{{- else -}}<i class="fas fa-pencil-alt"></i>{{- end -}} {{- if .Params.roles  -}}{{- else -}}<i class="fa fa-user"></i>{{- end -}}{{ if eq $current_schedule "reaction" }}<b>{{- .Params.requirements  -}}</b>{{- end -}}<a href="{{- .Permalink -}}"><b>{{ title .Title }}</b></a> {{- .Params.description -}} {{ if eq $current_schedule  nil }} -- Written by {{ title .Params.author -}}{{ end }}
</p>
{{ end }}

{{ end }} 
{{ end }}




{{ range  $schedules }}
{{ $current_schedule := . }} 


{{ if sort (where (where $event_pages "Layout" "==" "module" ) ".Params.schedule" "=="  $current_schedule ) "Params.weight" -}}
<h3>{{ title  $current_schedule }}</h3>
<p><b>{{ len (where (where $event_pages "Layout" "==" "module" ) ".Params.schedule" "=="  $current_schedule ) -}}</b> Modules to run </p>
{{ if eq $current_schedule  nil }}<p>Please add a schedule to your modules</p>{{ end }}
{{ range sort (where (where $event_pages "Layout" "=="  "module" ) ".Params.schedule" "=="  $current_schedule) "Params.weight" -}}

     <h1> {{ .Params.title -}} </h1>
<p><b>Written By:</b> {{ .Params.author -}}
{{- if (.Params.reviewer) -}}<div id="reviewer"> <p><b>Reviewed By:</b> {{ .Params.reviewer }} {{ end }}
{{- if  .Params.plotline -}}<div id="plotline"> <p><b>Plotline:</b> {{ .Params.plotline -}}</p></div>{{- end -}}
<div id="brief"> <p><b>Brief:</b> {{ .Params.description -}}</p></div>
{{- $requirements := (slice ) -}}
{{- if .Params.requirements -}} 
{{- if not (reflect.IsSlice .Params.requirements) -}}{{- $requirements = (slice .Params.requirements ) -}}
{{- else -}} {{- $requirements = append $requirements .Params.requirements -}}{{- end -}} 
{{- end -}}

{{- if .Params.schedule -}}{{- $schedule := print "Run on " ( title .Params.schedule )  -}}{{- $requirements = append $requirements (slice ( $schedule ) ) -}} {{- end -}}

{{- if $requirements -}}
<div id ="requirements"> 
<p><b>Requirements:</b></p>
    {{- range  $requirements -}}
    <li>{{- . -}}</li>
    {{- end -}}
</div>
{{ end }}
 {{- if .Params.background -}}<div id="background"> <p><b>Background:</b> {{ .Params.background | markdownify -}}</p></div>{{- end -}}
{{- if .Params.synopsis -}} <div id="synopsis"> <p><b>Synopsis:</b> {{ .Params.synopsis | markdownify -}}</p></div> {{ end }}
{{- if .Params.outcomes -}} 
{{- $outcomes := (slice ) -}} 
{{ if not (reflect.IsSlice .Params.outcomes) }}{{ $outcomes = (slice .Params.outcomes ) }}
{{ else  }} {{ $outcomes = append $outcomes .Params.outcomes }}{{ end }} 
<div id= "outcomes" ><p><b>Outcomes:</b></p>
<ol>
    {{ range $outcomes }}
    <li>{{ . }}</li>
    {{ end }}
</ol></div>
<div id="number_of_cast_members"> <p><b>Number of Cast Members:</b> {{ .Params.number_of_cast_members | default "1" }}<p></div> 
{{- if or (where .Pages ".Params.Layout" "IN" (slice "national_monster_card" "role" ))  (.Params.roles) -}} 
<div id="roles"><p><b>Roles:</b> 
{{ if .Params.roles }}{{ .Params.roles }} {{ end }}
{{- if where .Pages ".Params.Layout" "IN" (slice "national_monster_card" "role" ) -}} 
    {{- range $index, $value := where .Pages ".Params.Layout" "IN" ( slice "national_monster_card" "role" ) -}}
{{ if (ne $index 0) }}, {{ end }}
<a href="{{.Permalink}}">{{ .Params.quantity | default "" -}}{{- if .Params.quantity }}X {{ end }} {{.Title}} </a>
    {{- end -}}
{{ end }}
</p></div>
{{- end }}


{{ if or (where .Pages ".Params.Layout" "NOT IN" (slice "role" "feedback" "national_monster_card" )) (where .Pages ".Params.Layout" "==" nil) }} 
<div id="misc"><p><b>Misc: </b>
{{- range $index, $value := where .Pages ".Params.Layout" "NOT IN"  (slice "role" "feedback" "national_monster_card" ) -}} 
{{- if (ne $index 0) }}, {{ end -}}<a href="{{.Permalink}}">{{- .Title -}}</a>{{- end -}}

{{- range $index, $value := where .Pages ".Params.Layout" "==" nil -}} 
{{- if (ne $index 0) }}, {{ end -}}<a href="{{.Permalink}}">{{- .Title -}}</a>{{- end -}}</p></div>
{{- end -}}



{{ $props := (slice ) }}
{{ if  .Params.props }} 
{{ $props = $props  | append .Params.props }}
{{ end }}
{{ if .Pages }} 
    {{ range where .Pages ".Params.Layout" "IN" (slice "national_monster_card" "role" ) }}
                      {{ if  .Params.props }}{{ $props = $props  | append .Params.props }}{{ end }}
    {{ end }}
{{ end }}

{{ $props = $props  | uniq }}
{{ if (gt ($props | len) 0) }}
<div id="props"> <p><b>Props: </b> 
{{ delimit $props ", "}}
</p></div> 
{{ end }}


{{ $makeup := (slice ) }}
{{ if  .Params.makeup }} 
{{ $makeup = $makeup  | append .Params.makeup }} {{ end }}
{{ if .Pages }} 
    {{ range where .Pages ".Params.Layout" "IN" (slice "national_monster_card" "role" ) }}
           {{ if  .Params.makeup }}{{ $makeup = $makeup  | append .Params.makeup }}{{ end }}
    {{ end }}
{{ end }}
{{ $makeup := $makeup | uniq }} 
{{ if (gt ($makeup | len) 0) }}
<div id="makeup"> <p><b>Makeup: </b>
{{ delimit $makeup ", "}}
</p></div> 
{{ end }}

{{ $costuming := (slice ) }}
{{ if  .Params.costuming }}
{{ $costuming =  $costuming |append .Params.costuming }}
{{ end }}
{{ if .Pages }} 
    {{ range where .Pages ".Params.Layout" "IN" (slice "national_monster_card" "role" )  }}
             {{ if .Params.costuming }}  {{ $costuming =  $costuming |append .Params.costuming }} {{ end }}
    {{ end }}
{{ end }}
{{ $costuming := $costuming | uniq }}
{{ if (gt ($costuming | len) 0) }}
<div id="costuming"><p><b>Costuming:</b>
{{ delimit $costuming  ", "}}
</p></div> 
{{ end }}





{{ if or (.Params.treasure)  (.Params.magic_items) }}
<div id="treasure"> <p><b>Treasure:</b>
{{- $treasure := (slice ) -}} 
{{ if not (reflect.IsSlice .Params.treasure) }}{{ $treasure = (slice .Params.treasure ) }}
{{ else  }} {{ $treasure = append $treasure .Params.treasure }} {{- end -}} 
{{ delimit  $treasure ", " -}}
{{ $magic_items := (slice )  }}
{{- if .Params.magic_items -}}
    {{- $magic_items = append $magic_items .Params.magic_items -}}
{{- end -}}
{{- if (gt ($magic_items | len) 0) -}}

{{- range  $index,$magic_items  -}}
,
<b><i>{{- title .name -}}(</b></i>
<b>Description:</b> {{ .description }}
<b>Duration:</b> {{ title .duration }}
<b>Effects:</b> {{ delimit .effects ", " }}<b>)</b>
{{ end }} 
{{ end }}
</p></div>
{{ end }}

{{ if .Params.rumors }} <div id="rumors"> <p> <b>Rumors:</b> {{ .Params.rumors | markdownify }}</p></div> {{ end }} 

<div id="hook"> {{ if .Params.hook }}<p ><b>Hook:</b> {{ .Params.hook }} </p> {{ end }} </div> 

{{ if  .Params.scenes }} 
<div id="scenes"><p><b>Scenes:</b> {{ range .Params.scenes }}
      <ul><b>In Game:</b> {{ .ig}} 
      <b>Out of Game:</b> {{ .oog}} 
      <b>Flee Point:</b> {{ .flee_point}}</ul>
   {{ end }}</div>
{{ end}}

{{ if .Params.non_standard_effects }}<div id="non_standard_effects"> <p><b>Non Standard Effects:</b> {{ .Params.non_standard_effects }}</p> </div> {{ end }} 
{{ if .Params.rules_clarifications }}<div id="rules_clarifications"> <p><b>Rules Clarifications:</b> {{ .Params.rules_clarifications }}</p> </div> {{ end }} 
{{ if .Params.craftsman_information }}<div id="craftsman_information"><p><b>Craftsman Information:</b> {{ .Params.craftsman_information }}</p></div> {{ end }} 
{{ if .Params.transformations }}<div id="transformations"><p><b>Transformations:</b> {{ .Params.transformations }}</p></div> {{ end }} 
{{ if .Params.running_notes }}<div id ="running_notes"> <p><b>Running Notes:</b> {{ .Params.running_notes }}</p></div>{{ end }} 

{{ .Content }} 




{{ end }}


{{ end }}

{{ end }} 
{{ end }}